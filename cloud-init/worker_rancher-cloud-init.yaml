name: "Default deployment"
stages:
   initramfs:
     - commands:
       - passwd -l c3os
   # Disable password, enable only ssh access
     - if: '[ ! -d "/home/c3os" ]'
       name: "Ensure home directory is present"
       commands:
       - mkdir /home/c3os
       - chmod 755 /home/c3os
       - chown -R c3os /home/c3os
   network:
     - if: '[ ! -f "/usr/local/.deployed" ]'
       name: "Deploy cos-system"
       # here we specify the image to upgrade to
       commands:
         - |
             # Use `cos-deploy --docker-image <img-ref>` to deploy a custom image
             # By default latest cOS gets deployed
             cos-deploy --docker-image --force --no-verify quay.io/mudler/c3os:v1.21.4-1 && touch /usr/local/.deployed && shutdown -r now
     - dns:
         path: /etc/resolv.conf
         nameservers:
         - 8.8.8.8
     - name: "Setup users"
      #  users:
      #   root:
      #     password: "c3os"
       authorized_keys:
        c3os: 
        - github:mudler
     - if: '[ ! -f "/run/cos/recovery_mode" ]'
       commands:
       - ulimit -u unlimited
       - ulimit -n 900000
       - |
          mkdir /usr/local/bin || true
          RANCHER_STRING